{__NOLAYOUT__}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>进度汇报</title>
    <link rel="stylesheet" href="../../../../public/static/property_project/CSS/vant.css" />
    <script src="../../../../public/static/property_project/js/rem.js"></script>
    <script src="../../../../public/static/property_project/js/vue.js"></script>
    <script src="../../../../public/static/property_project/js/axios.js"></script>
    <script src="../../../../public/static/property_project/js/vant.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            background-color: #eeeeee;
        }

        #app {
            width: 7.5rem;
        }

        input::-webkit-input-placeholder {
            color: #cccccc;
        }

        input::-moz-placeholder {
            /* Mozilla Firefox 19+ */
            color: #cccccc;
        }

        input:-moz-placeholder {
            /* Mozilla Firefox 4 to 18 */
            color: #cccccc;
        }

        input:-ms-input-placeholder {
            /* Internet Explorer 10-11 */
            color: #cccccc;
        }

        textarea::-webkit-input-placeholder {
            color: #cccccc;
        }

        textarea::-moz-placeholder {
            /* Mozilla Firefox 19+ */
            color: #cccccc;
        }

        textarea:-moz-placeholder {
            /* Mozilla Firefox 4 to 18 */
            color: #cccccc;
        }

        textarea:-ms-input-placeholder {
            /* Internet Explorer 10-11 */
            color: #cccccc;
        }

        .view {
            width: calc(100% - .6rem);
            padding: .24rem .3rem .24rem .3rem;
            height: .96rem;
            margin-bottom: .2rem;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            margin-top: .2rem;
            position: relative;
        }

        .view_title {
            height: .4rem;
            line-height: .4rem;
            position: relative;
            color: #222222;
            font-size: .28rem;
            font-family: PingFang-SC-Medium, PingFang-SC;
        }

        .view_value {
            width: 100%;
            height: .4rem;
            position: relative;
            margin-top: .16rem;
        }

        .view_value input {
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            font-size: .28rem;
            color: #222222;
        }

        .view_content {
            height: 2.42rem;
            position: relative;
        }

        .view_value_content {
            width: 100%;
            height: 1.4rem;
            margin-top: .16rem;
            position: relative;
        }

        .view_value_content textarea {
            width: 100%;
            height: 100%;
            position: absolute;
            border: none;
            outline: none;
            resize: none;
        }

        .view_foot {
            height: .34rem;
            line-height: .34rem;
            position: absolute;
            bottom: .24rem;
            right: .3rem;
            font-size: .24rem;
            line-height: .34rem;
            display: flex;
            flex-direction: row;
            justify-content: right;
        }

        .view_foot span {
            color: #222222;
            display: block;
        }

        .view_foot p {
            color: #999999;
            display: block;
        }

        .btn {
            width: calc(100% - .6rem);
            height: .9rem;
            position: fixed;
            left: .3rem;
            bottom: 1rem;
            background-color: #1979FF;
            border-radius: .08rem;
            color: #ffffff;
            font-family: PingFang-SC-Bold, PingFang-SC;
            font-size: .34rem;
            line-height: .9rem;
            text-align: center;
        }

        .van-cell {
            padding: 0;
        }

        .van-field__word-limit {
            margin-top: .8rem;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="view">
            <div class="view_title">
                <p>标题</p>
            </div>
            <div class="view_value">
                <input ref="titleRef" v-model="title" type="text" placeholder="清晰的标题会更容易被理解">
            </div>
        </div>
        <div class="view view_content">
            <div class="view_title">
                <p>内容描述</p>
            </div>
            <div class="message">
                <van-field v-model="message" rows="2" autosize size="large" type="textarea" maxlength="50"
                    placeholder="请输入留言" show-word-limit></van-field>
            </div>
        </div>

        <div @click="submitFn" class="btn">提交</div>
    </div>
    <script>
        Vue.use(vant.Field)
        new Vue({
            el: "#app",
            data() {
                return {
                    title: '',
                    message: '',
                    curId: 0
                }
            },
            methods: {
                // 获取个人信息方法
                getUserinfoFn() {
                    axios({
                        method: 'POST',
                        url: 'http://estate.1yuaninfo.com/getUserInfo',
                        headers: {
                            authorization: window.localStorage.getItem('token') || ''
                        }
                    }).then(res => {
                        console.log('个人信息', res)
                        if (res.data.status == 1002) {
                            // token过期
                            alert('登录已过期')
                            window.location.href = 'http://estate.1yuaninfo.com/index/property/logins'
                        } else if (res.data.status == 200) {
                            // 一切正常
                            this.userinfoList = res.data.result
                        }
                    }).catch(err => {
                        console.log('个人信息进入catch', err)
                    })
                },
                // 取值函数
                GetRequest() {
                    var url = location.search; //获取url中"?"符后的字串
                    var theRequest = new Object();
                    if (url.indexOf("?") != -1) {
                        var str = url.substr(1);
                        var strs = str.split("&");
                        for (var i = 0; i < strs.length; i++) {
                            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                        }
                    }
                    return theRequest;
                },
                // 调用填写任务进度接口
                submitFn() {
                   if(this.title.trim() === '') {
                      this.$refs.titleRef.focus()
                      alert('标题不能为空')
                      return
                    }
                   if(this.message.trim() === '') {
                      return alert('内容不能为空')
                    }
                    axios({
                        method: 'POST',
                        url: 'http://estate.1yuaninfo.com/order/addLog',
                        headers: {
                            authorization: window.localStorage.getItem('token') || ''
                        },
                        data: {
                            id: this.curId,
                            title: this.title,
                            desc: this.message
                        }
                    }).then(res => {
                        console.log('调用填写任务进度接口成功', res)
                        this.title = ''
                        this.message = ''
                        alert(res.data.message)     
                    }).catch(err => {
                        console.log('调用填写任务进度接口失败', err)
                    })
                }
            },
            created() {
                const id = this.GetRequest().id
                this.curId = id
                this.getUserinfoFn()
            }
        })
    </script>
</body>

</html>